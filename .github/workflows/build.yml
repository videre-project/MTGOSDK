name: Build
on:
  push:
    branches: [main]
  pull_request:
    types: [ opened, synchronize, closed, reopened ]
    # paths:
  workflow_dispatch:
env:
  MSBUILD_DEFAULTS: |
    /maxcpucount:2 ^
    /v:m /clp:ShowCommandLine ^
    /p:Configuration=Release ^
    /p:Platform="Any CPU"
jobs:
  # Runs test suite
  build:
    runs-on: windows-latest
    name: "MSBuild Runner"
    steps:
      # Fetches remote repository without --progress option.
      #
      # The default behavior of @actions/checkout outputs many noisy lines of
      # status output in the workflow log, which is problematic for log size.
      - name: Checkout latest repository commit
        uses: actions/checkout@v4
        with:
          show-progress: false
      # Setup the .NET Environment
      - name: Install .NET Core
        uses: actions/setup-dotnet@v3
      - name: Setup MSBuild.exe
        uses: microsoft/setup-msbuild@v1.3.1
      # Setup MTGO installation and reference assemblies
      - name: Build Reference Assemblies
        run: |
          msbuild Ref.sln /t:Restore ${{ env.MSBUILD_DEFAULTS }}
          msbuild Ref.sln /t:Build   ${{ env.MSBUILD_DEFAULTS }}
      # Build the SDK
      - name: Build SDK Solution
        run: |
          msbuild SDK.sln /t:Restore ${{ env.MSBUILD_DEFAULTS }}
          msbuild SDK.sln /t:Build   ${{ env.MSBUILD_DEFAULTS }}
