<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFrameworks>netstandard2.0;net8.0-windows</TargetFrameworks>
    <LangVersion>Latest</LangVersion>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <NoWarn>$(NoWarn);
      <!-- Disables unenforcable nullable warnings - breaks static analysis -->
      CS8597;CS8600;CS8602;CS8603;CS8604;CS8625;IDE0065;
      <!-- FIXME: From RemoteNET library -->
      CS8601;CS8608;CS8610;CS8618;CS8619;CS8620;CS8765;
      <!-- FIXME: From ScubaDiver.API library -->
      1701;1702;8600;8602;8603;8618;8625;
      CS0436;CS9113;CS8767;MSB3277
    </NoWarn>
  </PropertyGroup>

  <ItemGroup>
		<PackageReference Include="Microsoft.CSharp"
                      Version="4.7.0" />
    <PackageReference Include="Microsoft.Diagnostics.Runtime"
                      Version="3.1.512801" />
    <PackageReference Include="Meziantou.Polyfill"
                      Version="1.0.37" />
    <PackageReference Include="ImpromptuInterface"
                      Version="8.0.4" />
    <PackageReference Include="Newtonsoft.Json"
                      Version="13.0.3" />
    <ProjectReference Include="..\MTGOSDK.Win32\MTGOSDK.Win32.csproj" />
  </ItemGroup>

  <!-- Configures build-time resource dependencies for MSBuild -->
  <Target Name="CollectResourceProjects"
          BeforeTargets="ResolveProjectReferences"
          Condition="'$(TargetFramework)' != 'netstandard2.0'">
    <ItemGroup>
      <ResourceProjects Include="..\third_party\RemoteNET\src\ScubaDiver\ScubaDiver.csproj" />
      <ResourceProjects Include="..\third_party\SharpNeedle\src\Bootstrapper\*.vcxproj" />
      <ResourceProjects Include="..\third_party\SharpNeedle\src\Launcher\*.vcxproj" />
      <ProjectReference Include="@(ResourceProjects)"
                        ReferenceOutputAssembly="false"
                        Private="false" />
    </ItemGroup>
    <Message Text="MTGOSDK.Resources: Collected @(ResourceProjects->Count()) resource projects."
             Importance="High" />
  </Target>

  <!-- Bundle all build artifacts into this assembly's resources -->
  <Target Name="EmbedResources"
          BeforeTargets="CoreCompile"
          AfterTargets="ResolveProjectReferences"
          DependsOnTargets="CollectResourceProjects"
          Condition="'@(ResourceProjects)' != ''">
    <ItemGroup>
      <ResourceFiles Include="$(SolutionDir)\dist\$(Configuration)\Win32\*.dll" />
      <ResourceFiles Include="$(SolutionDir)\dist\$(Configuration)\Win32\*.exe" />
      <ResourceFiles Include="$(SolutionDir)\dist\$(Configuration)\x64\*.dll" />
      <ResourceFiles Include="$(SolutionDir)\dist\$(Configuration)\x64\*.exe" />
      <ResourceFiles Include="$(SolutionDir)\dist\$(Configuration)\*.dll" />
      <EmbeddedResource Include="@(ResourceFiles)"
                        LogicalName="Resources\%(Filename)" />
    </ItemGroup>
    <Message Text="MTGOSDK.Resources: Embedded @(ResourceFiles->Count()) resources into $(AssemblyName)."
             Importance="High" />
	</Target>

  <!-- Import MTGOSDK package properties -->
  <Import Project="MTGOSDK.pkg.props" />

  <!-- Import MTGOSDK reference assemblies -->
  <Import Project="MTGOSDK.ref.props" />

</Project>