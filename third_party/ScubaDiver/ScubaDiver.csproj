<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
    <TargetFramework>net48</TargetFramework>
    <LangVersion>Latest</LangVersion>
    <OutputType>Library</OutputType>
    <RootNamespace>ScubaDiver</RootNamespace>
    <IsPackable>false</IsPackable>
    <!-- Merge the ScubaDiver assembly with ClrMD and other dependencies -->
    <ILRepackTargetsFile>
      $(MSBuildThisFileDirectory)lib\ILRepack\ILRepack.targets
    </ILRepackTargetsFile>
  </PropertyGroup>

  <!-- Compiler Options -->
  <PropertyGroup>
    <Deterministic>true</Deterministic>
    <FileAlignment>512</FileAlignment>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <ResolveAssemblyReferencesSilent>true</ResolveAssemblyReferencesSilent>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>

  <!-- Debugging Options -->
  <PropertyGroup Condition="'$(Configuration)' == 'Debug'">
    <DefineConstants>DEBUG;TRACE</DefineConstants>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)' == 'Release'">
    <DefineConstants>TRACE</DefineConstants>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Diagnostics.Runtime" />
    <ProjectReference Include="$(SolutionDir)\MTGOSDK\MTGOSDK.csproj"
                      SetTargetFramework="TargetFramework=$(_MTGOSDKCoreTFM)" />
    <ProjectReference Include="$(SolutionDir)\MTGOSDK.Win32\MTGOSDK.Win32.csproj" />
    <!-- .NET Framework references and redirects -->
    <PackageReference Include="Microsoft.Bcl.AsyncInterfaces" />
    <PackageReference Include="System.Runtime.CompilerServices.Unsafe" />
  </ItemGroup>

  <!-- Remove runtime bindings/redirects from the final output -->
  <ItemGroup>
    <None Remove="app.config" />
    <Resource Include="app.config" CopyToOutputDirectory="Never" />
  </ItemGroup>

  <!-- Configures build-time project dependencies for the core SDK assembly -->
  <Target Name="ReferenceCoreSDK"
          BeforeTargets="ResolveProjectReferences"
          Condition="'$(UseFullSDKPaths)' == 'true'">
    <MSBuild Projects="$(SolutionDir)MTGOSDK\MTGOSDK.csproj"
             Targets="Build"
             Properties="TargetFramework=$(_MTGOSDKCoreTFM)"
             Condition="!Exists('$(_MTGOSDKCorePath)\MTGOSDK.dll')" />
  </Target>

</Project>