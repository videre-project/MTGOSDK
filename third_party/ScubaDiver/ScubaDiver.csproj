<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
    <TargetFramework>net48</TargetFramework>
    <LangVersion>Latest</LangVersion>
    <OutputType>Library</OutputType>
    <RootNamespace>ScubaDiver</RootNamespace>
    <IsPackable>false</IsPackable>
    <EnableSourceLink>false</EnableSourceLink>
  </PropertyGroup>

  <!-- Compiler Options -->
  <PropertyGroup>
    <Deterministic>true</Deterministic>
    <FileAlignment>512</FileAlignment>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <ResolveAssemblyReferencesSilent>true</ResolveAssemblyReferencesSilent>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>

  <!-- Debugging Options -->
  <PropertyGroup Condition="'$(Configuration)' == 'Debug'">
    <DefineConstants>DEBUG;TRACE</DefineConstants>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)' == 'Release'">
    <DefineConstants>TRACE</DefineConstants>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Diagnostics.Runtime" />
    <ProjectReference Include="$(SolutionDir)\MTGOSDK\MTGOSDK.csproj"
                      SetTargetFramework="TargetFramework=$(MTGOSDKCoreTFM)" />
    <ProjectReference Include="$(SolutionDir)\MTGOSDK.Win32\MTGOSDK.Win32.csproj" />
    <!-- .NET Framework references and redirects -->
    <None Include="app.config" />
    <PackageReference Include="Microsoft.NETFramework.ReferenceAssemblies"
                      PrivateAssets="all" />
    <PackageReference Include="Microsoft.Bcl.AsyncInterfaces" />
    <PackageReference Include="System.Runtime.CompilerServices.Unsafe" />
    <!-- Build time dependencies -->
    <PackageReference Include="ILRepack"
                      PrivateAssets="all" />
    <PackageReference Include="ILRepack.Lib.MSBuild.Task"
                      PrivateAssets="all" />
  </ItemGroup>

  <!-- Configures build-time project dependencies for the core SDK assembly -->
  <Target Name="ReferenceCoreSDK"
          BeforeTargets="ResolveProjectReferences"
          Condition="'$(UseFullSDKPaths)' == 'true'">
    <MSBuild Projects="$(SolutionDir)MTGOSDK\MTGOSDK.csproj"
             Targets="Build"
             Properties="TargetFramework=$(MTGOSDKCoreTFM)"
             Condition="!Exists('$(MTGOSDKCorePath)\MTGOSDK.dll')" />
  </Target>

  <!-- Merge the ScubaDiver assembly with ClrMD and other dependencies -->
  <PropertyGroup>
    <ILRepackTargetsFile>lib\ILRepack\ILRepack.targets</ILRepackTargetsFile>
  </PropertyGroup>
  <ImportGroup Condition="'$(UseFullSDKPaths)' == 'true'">
    <Import Project="$(ILRepackTargetsFile)" />
  </ImportGroup>

</Project>